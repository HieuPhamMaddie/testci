version: 2.1
orbs:
  k8s: digitalocean/k8s@0.1.1

jobs:
  deploy:
    executor: k8s/default
    steps:
      - setup_remote_docker:
          version: 20.10.7
      - k8s/install
      - k8s/use-context:
          context-name: my-k8s-context
      - k8s/configure-kubectl
      - checkout # Đảm bảo sao chép toàn bộ nội dung của kho lưu trữ
      - run:
          name: Deploy to Kubernetes
          command: |
            kubectl apply -f infra/deploy.yml

workflows:
  version: 2
  deploy_workflow:
    jobs:
      - deploy:
          filters:
            branches:
              only:
                - main # Thay đổi thành nhánh bạn muốn triển khai
